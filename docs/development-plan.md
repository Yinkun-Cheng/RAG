# 测试用例知识库管理系统 - 完整开发计划

## 项目概述

**项目名称**: 测试用例知识库管理系统（RAG）  
**开发周期**: 15 个工作日  
**技术栈**: Go + React + PostgreSQL + Weaviate  
**开发模式**: 迭代开发，每个阶段可独立验收

---

## 📅 Phase 1: 环境搭建与基础架构（第 1-2 天）

### Day 1: 项目初始化

#### 上午：后端项目初始化
- [ ] 创建 Go 项目结构
  - [ ] 初始化 `go.mod`
  - [ ] 创建目录结构（cmd, internal, pkg, migrations）
  - [ ] 配置 `.gitignore`
- [ ] 安装核心依赖
  - [ ] Gin 框架
  - [ ] GORM
  - [ ] PostgreSQL 驱动
  - [ ] Weaviate Go 客户端
  - [ ] Viper（配置管理）
  - [ ] Zap（日志）
- [ ] 创建配置文件结构
  - [ ] `config.yaml`
  - [ ] 环境变量支持

#### 下午：前端项目初始化
- [ ] 使用 Vite 创建 React + TypeScript 项目
- [ ] 安装核心依赖
  - [ ] Ant Design
  - [ ] React Router
  - [ ] React Query
  - [ ] Zustand
  - [ ] Axios
  - [ ] Tailwind CSS
- [ ] 配置 ESLint + Prettier
- [ ] 配置路由基础结构
- [ ] 创建基础 Layout 组件

**交付物**:
- ✅ 后端项目可以启动（Hello World）
- ✅ 前端项目可以启动（空白页面）
- ✅ 配置文件完整

---

### Day 2: 数据库与 Docker 环境

#### 上午：数据库设计与迁移
- [ ] 编写数据库迁移脚本
  - [ ] `001_create_modules.sql`
  - [ ] `002_create_prds.sql`
  - [ ] `003_create_test_cases.sql`
  - [ ] `004_create_tags.sql`
  - [ ] `005_create_relations.sql`
- [ ] 创建 GORM 模型
  - [ ] Module
  - [ ] PRDDocument
  - [ ] TestCase
  - [ ] Tag
- [ ] 编写数据库初始化脚本
  - [ ] 默认模块数据
  - [ ] 默认标签数据

#### 下午：Docker 环境配置
- [ ] 编写 `docker-compose.yml`
  - [ ] PostgreSQL 服务
  - [ ] 复用 Dify 的 Weaviate
  - [ ] 后端服务
  - [ ] 前端服务
  - [ ] Nginx 反向代理
- [ ] 编写 Dockerfile
  - [ ] 后端 Dockerfile（多阶段构建）
  - [ ] 前端 Dockerfile
- [ ] 编写 `.env.example`
- [ ] 测试 Docker 环境启动

**交付物**:
- ✅ 数据库表结构创建成功
- ✅ Docker 环境可以一键启动
- ✅ 后端可以连接数据库
- ✅ 前端可以访问后端 API

---

## 📅 Phase 2: 核心功能 - 模块与标签（第 3 天）

### Day 3: 模块与标签管理

#### 上午：后端 API 开发
- [ ] 实现模块 API
  - [ ] `GET /api/v1/modules/tree` - 获取模块树
  - [ ] `POST /api/v1/modules` - 创建模块
  - [ ] `PUT /api/v1/modules/:id` - 更新模块
  - [ ] `DELETE /api/v1/modules/:id` - 删除模块
- [ ] 实现标签 API
  - [ ] `GET /api/v1/tags` - 获取所有标签
  - [ ] `POST /api/v1/tags` - 创建标签
  - [ ] `PUT /api/v1/tags/:id` - 更新标签
  - [ ] `DELETE /api/v1/tags/:id` - 删除标签
- [ ] 编写单元测试

#### 下午：前端组件开发
- [ ] 创建 ModuleTree 组件
  - [ ] 树形展示
  - [ ] 展开/折叠
  - [ ] 右键菜单（新建/编辑/删除）
- [ ] 创建 TagSelect 组件
  - [ ] 下拉多选
  - [ ] 创建新标签
  - [ ] 颜色显示
- [ ] 集成 API 调用
- [ ] 测试功能

**交付物**:
- ✅ 模块管理功能完整（增删改查）
- ✅ 标签管理功能完整（增删改查）
- ✅ 前端可以操作模块树和标签

---

## 📅 Phase 3: PRD 文档管理（第 4-5 天）

### Day 4: PRD 后端 API

#### 上午：PRD CRUD API
- [ ] 实现 PRD 基础 API
  - [ ] `GET /api/v1/prds` - 列表（分页、筛选、搜索）
  - [ ] `GET /api/v1/prds/:id` - 详情
  - [ ] `POST /api/v1/prds` - 创建
  - [ ] `PUT /api/v1/prds/:id` - 更新
  - [ ] `DELETE /api/v1/prds/:id` - 删除
- [ ] 实现 PRD 版本管理
  - [ ] `GET /api/v1/prds/:id/versions` - 版本列表
  - [ ] `GET /api/v1/prds/:id/versions/:version` - 特定版本
  - [ ] 自动创建版本历史

#### 下午：PRD 关联功能
- [ ] 实现 PRD 标签关联
- [ ] 实现 PRD 与测试用例关联查询
- [ ] 编写单元测试
- [ ] API 文档（Swagger）

**交付物**:
- ✅ PRD 完整的 CRUD API
- ✅ PRD 版本管理功能
- ✅ API 测试通过

---

### Day 5: PRD 前端页面

#### 上午：PRD 列表与详情
- [ ] 创建 PRD 列表页
  - [ ] 表格展示
  - [ ] 搜索框
  - [ ] 筛选器（模块、状态、标签）
  - [ ] 分页
- [ ] 创建 PRD 详情页
  - [ ] Markdown 渲染
  - [ ] 版本历史展示
  - [ ] 关联测试用例列表

#### 下午：PRD 创建与编辑
- [ ] 集成 Monaco Editor
  - [ ] Markdown 编辑
  - [ ] 实时预览
  - [ ] 工具栏
- [ ] 创建 PRD 表单页
  - [ ] 基本信息表单
  - [ ] Markdown 编辑器
  - [ ] 标签选择
  - [ ] 保存/发布功能
- [ ] 测试完整流程

**交付物**:
- ✅ PRD 列表页完整
- ✅ PRD 详情页完整
- ✅ PRD 创建/编辑功能完整
- ✅ Markdown 编辑器可用

---

## 📅 Phase 4: 测试用例管理（第 6-8 天）

### Day 6: 测试用例后端 API

#### 上午：测试用例 CRUD
- [ ] 实现测试用例基础 API
  - [ ] `GET /api/v1/testcases` - 列表
  - [ ] `GET /api/v1/testcases/:id` - 详情
  - [ ] `POST /api/v1/testcases` - 创建
  - [ ] `PUT /api/v1/testcases/:id` - 更新
  - [ ] `DELETE /api/v1/testcases/:id` - 删除
- [ ] 实现测试步骤管理
  - [ ] 步骤的增删改查
  - [ ] 步骤排序

#### 下午：文件上传功能
- [ ] 实现文件上传 API
  - [ ] `POST /api/v1/upload/screenshot` - 上传截图
  - [ ] `DELETE /api/v1/upload/:id` - 删除文件
- [ ] 配置文件存储
  - [ ] 本地存储
  - [ ] 文件路径管理
- [ ] 实现截图与步骤关联
- [ ] 编写单元测试

**交付物**:
- ✅ 测试用例 CRUD API 完整
- ✅ 文件上传功能可用
- ✅ 截图可以关联到测试步骤

---

### Day 7: 测试用例前端（列表与详情）

#### 上午：测试用例列表
- [ ] 创建测试用例列表页
  - [ ] 表格展示
  - [ ] 多维度筛选器
  - [ ] 搜索功能
  - [ ] 批量操作
  - [ ] 分页

#### 下午：测试用例详情
- [ ] 创建测试用例详情页
  - [ ] 基本信息展示
  - [ ] 前置条件展示
  - [ ] 测试步骤展示（含截图）
  - [ ] 截图预览（点击放大）
  - [ ] 预期结果展示
  - [ ] 版本历史

**交付物**:
- ✅ 测试用例列表页完整
- ✅ 测试用例详情页完整
- ✅ 截图可以正常显示和预览

---

### Day 8: 测试用例前端（创建与编辑）

#### 上午：测试用例表单
- [ ] 创建测试用例表单页
  - [ ] 基本信息表单
  - [ ] 前置条件输入
  - [ ] 预期结果输入
  - [ ] 标签选择

#### 下午：测试步骤编辑
- [ ] 实现动态步骤管理
  - [ ] 添加步骤
  - [ ] 删除步骤
  - [ ] 步骤排序（拖拽）
- [ ] 实现截图上传
  - [ ] ImageUpload 组件
  - [ ] 拖拽上传
  - [ ] 多文件上传
  - [ ] 预览和删除
- [ ] 表单验证
- [ ] 测试完整流程

**交付物**:
- ✅ 测试用例创建功能完整
- ✅ 测试用例编辑功能完整
- ✅ 截图上传功能完整
- ✅ 可以创建包含多个步骤和截图的用例

---

## 📅 Phase 5: 导入功能（第 9-10 天）

### Day 9: Excel 导入

#### 上午：Excel 解析
- [ ] 安装 Excel 解析库（excelize）
- [ ] 实现 Excel 解析逻辑
  - [ ] 读取 Excel 文件
  - [ ] 解析表头
  - [ ] 解析数据行
  - [ ] 数据验证
- [ ] 实现批量创建测试用例
  - [ ] 事务处理
  - [ ] 错误收集

#### 下午：Excel 导入 API 与前端
- [ ] 实现导入 API
  - [ ] `POST /api/v1/import/excel`
  - [ ] 返回导入结果
- [ ] 创建导入页面
  - [ ] 文件上传组件
  - [ ] 模板下载
  - [ ] 导入预览
  - [ ] 结果展示
- [ ] 测试导入功能

**交付物**:
- ✅ Excel 导入功能完整
- ✅ 可以批量导入测试用例
- ✅ 错误提示清晰

---

### Day 10: XMind 和 Word 导入

#### 上午：XMind 导入
- [ ] 研究 XMind 文件格式（ZIP + XML）
- [ ] 实现 XMind 解析
  - [ ] 解压 XMind 文件
  - [ ] 解析 XML 内容
  - [ ] 转换为测试用例结构
- [ ] 实现导入 API
  - [ ] `POST /api/v1/import/xmind`
- [ ] 前端集成

#### 下午：Word 导入
- [ ] 安装 Word 解析库
- [ ] 实现 Word 解析
  - [ ] 解析 .docx 文件
  - [ ] 提取文本内容
  - [ ] 转换为 PRD 结构
- [ ] 实现导入 API
  - [ ] `POST /api/v1/import/word`
- [ ] 前端集成
- [ ] 测试所有导入功能

**交付物**:
- ✅ XMind 导入功能完整
- ✅ Word 导入功能完整
- ✅ 三种导入方式都可用

---

## 📅 Phase 6: RAG 检索功能（第 11-12 天）

### Day 11: Weaviate 集成

#### 上午：Weaviate 配置
- [ ] 配置 Weaviate 连接
  - [ ] 复用 Dify 的 Weaviate 实例
  - [ ] 创建 Collection Schema
    - [ ] PRDDocument Collection
    - [ ] TestCase Collection
- [ ] 实现向量化服务
  - [ ] 调用 BrConnector Claude 4.5 生成 Embedding
  - [ ] 或使用专门的 Embedding 模型

#### 下午：数据同步
- [ ] 实现 PostgreSQL → Weaviate 同步
  - [ ] PRD 创建时同步
  - [ ] PRD 更新时同步
  - [ ] PRD 删除时同步
  - [ ] 测试用例同步（同上）
- [ ] 实现批量同步脚本
  - [ ] 同步历史数据
- [ ] 测试同步功能

**交付物**:
- ✅ Weaviate 配置完成
- ✅ 数据可以自动同步到 Weaviate
- ✅ 向量化功能正常

---

### Day 12: 语义检索与推荐

#### 上午：语义检索 API
- [ ] 实现语义检索
  - [ ] `POST /api/v1/search`
  - [ ] 向量相似度搜索
  - [ ] 结合结构化过滤
  - [ ] 结果排序和高亮
- [ ] 实现关联推荐
  - [ ] `GET /api/v1/recommend/:prd_id`
  - [ ] 基于 PRD 推荐相关测试用例
  - [ ] 基于测试用例推荐相关 PRD

#### 下午：前端搜索页面
- [ ] 创建搜索页面
  - [ ] 搜索框
  - [ ] 类型筛选
  - [ ] 结果分类展示
  - [ ] 高亮匹配内容
- [ ] 集成全局搜索
  - [ ] 顶部导航栏搜索框
  - [ ] 快捷键支持（Ctrl+K）
- [ ] 测试搜索功能

**交付物**:
- ✅ 语义检索功能完整
- ✅ 关联推荐功能完整
- ✅ 搜索页面可用
- ✅ 搜索结果准确

---

## 📅 Phase 7: Dify 集成（第 13 天）

### Day 13: Dify 外部知识库 API

#### 上午：实现 Dify 接口
- [ ] 研究 Dify 外部知识库 API 规范
- [ ] 实现 Dify 检索接口
  - [ ] `POST /api/v1/dify/retrieval`
  - [ ] 符合 Dify 规范的请求/响应格式
  - [ ] 支持 top_k 和 score_threshold
  - [ ] 返回格式化的内容和元数据
- [ ] 编写接口文档

#### 下午：Dify 配置与测试
- [ ] 在 Dify 中配置外部知识库
  - [ ] 添加 API 端点
  - [ ] 配置认证（如需要）
- [ ] 测试 Dify 调用
  - [ ] 在 Dify Agent 中测试检索
  - [ ] 验证返回结果
- [ ] 实现影响分析功能
  - [ ] `POST /api/v1/impact-analysis`
  - [ ] 分析需求变更影响范围
  - [ ] 生成测试用例更新建议

**交付物**:
- ✅ Dify 外部知识库 API 完整
- ✅ Dify 可以成功调用检索接口
- ✅ 影响分析功能可用

---

## 📅 Phase 8: 优化与完善（第 14-15 天）

### Day 14: 功能完善与优化

#### 上午：功能完善
- [ ] 实现统计功能
  - [ ] `GET /api/v1/statistics`
  - [ ] 仪表盘数据
- [ ] 创建仪表盘页面
  - [ ] 统计卡片
  - [ ] 图表展示
  - [ ] 最近更新列表
- [ ] 实现批量操作
  - [ ] 批量删除
  - [ ] 批量导出

#### 下午：性能优化
- [ ] 后端优化
  - [ ] 数据库查询优化
  - [ ] 添加索引
  - [ ] API 响应时间优化
- [ ] 前端优化
  - [ ] 代码分割
  - [ ] 图片懒加载
  - [ ] 列表虚拟滚动
- [ ] 缓存策略
  - [ ] React Query 缓存配置
  - [ ] 静态资源缓存

**交付物**:
- ✅ 仪表盘页面完整
- ✅ 批量操作功能完整
- ✅ 性能优化完成

---

### Day 15: 测试、文档与部署

#### 上午：测试
- [ ] 功能测试
  - [ ] 完整流程测试
  - [ ] 边界情况测试
  - [ ] 错误处理测试
- [ ] 性能测试
  - [ ] 大数据量测试
  - [ ] 并发测试
- [ ] 修复发现的 Bug

#### 下午：文档与部署
- [ ] 完善文档
  - [ ] 用户使用手册
  - [ ] API 文档
  - [ ] 部署文档
- [ ] 部署准备
  - [ ] 环境变量配置
  - [ ] Docker 镜像构建
  - [ ] Nginx 配置
- [ ] 正式部署
  - [ ] 启动所有服务
  - [ ] 验证功能
- [ ] 项目交付

**交付物**:
- ✅ 所有功能测试通过
- ✅ 文档完整
- ✅ 系统成功部署
- ✅ 项目验收

---

## 📊 里程碑检查点

### Milestone 1: 基础架构完成（Day 2）
- ✅ 项目可以启动
- ✅ 数据库连接正常
- ✅ Docker 环境可用

### Milestone 2: PRD 管理完成（Day 5）
- ✅ PRD 完整的增删改查
- ✅ Markdown 编辑器可用
- ✅ 版本管理功能

### Milestone 3: 测试用例管理完成（Day 8）
- ✅ 测试用例完整的增删改查
- ✅ 步骤管理功能
- ✅ 截图上传功能

### Milestone 4: 导入功能完成（Day 10）
- ✅ Excel 导入
- ✅ XMind 导入
- ✅ Word 导入

### Milestone 5: RAG 功能完成（Day 12）
- ✅ 语义检索
- ✅ 关联推荐
- ✅ Weaviate 集成

### Milestone 6: Dify 集成完成（Day 13）
- ✅ 外部知识库 API
- ✅ Dify 可以调用

### Milestone 7: 项目完成（Day 15）
- ✅ 所有功能完整
- ✅ 测试通过
- ✅ 成功部署

---

## 🎯 每日工作流程

### 开始工作前
1. 查看当天任务清单
2. 拉取最新代码
3. 启动开发环境

### 开发过程中
1. 按照任务清单逐项完成
2. 及时提交代码（小步提交）
3. 编写必要的注释和文档
4. 自测功能

### 结束工作时
1. 提交当天代码
2. 更新任务完成状态
3. 记录遇到的问题和解决方案
4. 规划第二天任务

---

## 🚨 风险与应对

### 风险 1: Weaviate 集成困难
**应对**: 
- 先使用简单的关键词搜索
- 后续再优化为向量检索

### 风险 2: XMind 解析复杂
**应对**:
- 优先实现 Excel 导入
- XMind 导入作为增强功能

### 风险 3: 时间不足
**应对**:
- 优先完成核心功能（PRD + 测试用例管理）
- 导入和 RAG 功能可以后续迭代

### 风险 4: 性能问题
**应对**:
- 先实现功能，后优化性能
- 使用分页和虚拟滚动

---

## 📝 开发规范

### Git 提交规范
```
feat: 新功能
fix: 修复 Bug
docs: 文档更新
style: 代码格式调整
refactor: 重构
test: 测试相关
chore: 构建/工具相关
```

### 分支管理
- `main`: 主分支（稳定版本）
- `develop`: 开发分支
- `feature/*`: 功能分支
- `fix/*`: 修复分支

### 代码审查
- 每个功能完成后自我审查
- 关键功能记录测试用例

---

## 🎉 项目完成标准

### 功能完整性
- ✅ PRD 管理（增删改查、版本管理）
- ✅ 测试用例管理（增删改查、步骤管理、截图上传）
- ✅ 导入功能（Excel/XMind/Word）
- ✅ RAG 检索（语义搜索、关联推荐）
- ✅ Dify 集成（外部知识库 API）

### 质量标准
- ✅ 所有核心功能测试通过
- ✅ 无严重 Bug
- ✅ 性能满足要求（列表加载 < 1s）
- ✅ 代码规范统一

### 文档完整性
- ✅ API 文档完整
- ✅ 用户使用手册
- ✅ 部署文档

### 部署成功
- ✅ Docker 环境一键启动
- ✅ 所有服务正常运行
- ✅ 可以正常访问和使用

---

## 下一步行动

**立即开始**: Day 1 - 项目初始化

准备好了吗？我们从 Day 1 的后端项目初始化开始！🚀
